<head>
<link href="http://content.doublestruck.eu/style/ds.css" rel="stylesheet" type="text/css">
</head>
<div class="ui container">
<h1 class="ui inverted red header"><%= @test_paper.name || @test_paper.date.strftime('%b %Y') %> </h1>
<% @test_paper.main_questions.each do |mq| %>
<div class="ui segment">
  <% mq.questions.each_with_index do |question, index| %>
  	<% 	even = nil
  		bg = 'white'
  		if index % 2 == 0 then even = true else even = false end 
  		if even then bg = '#F3F3F3'
  		else bg = 'white'
  		 end
  	%>
	<div style="width:705px; margin: auto; page-break-inside: avoid; align: center; <%= if even then 'background-color: #F3F3F3' end %>"><%= question.html.html_safe %> </div>
		
	<div class="labels">
	<% if (index + 1) == mq.questions.count then %>
		<% top = -3.5 %>
	<% else %>
		<% top = -1.34 %>
	<% end %>
	<% if question.answers.where(question: question, user: current_user).count != 0 %>

       <div style="width:705px; margin: auto;  top: 30px; text-align: right;"><a class="ui right floated answer-<%=question.id%>-button" style="float:right; background-color: <%= bg %> ;position: relative; top: <%= top %>em;"><strong><%= marks(question) %></strong></a></div>

       <% else %>
       <div style="width:705px; margin: auto; top: 30px"><a class="ui right floated answer-<%=question.id%>-button" style="float:right; background-color: <%= bg %> ;position: relative; top: <%= top %>em;"><strong>answer</strong></a>

       </div>
       <% end %>
	</div>


	<div class="ui modal answer-modal-<%= question.id %>">
		<i class="close icon"></i>
  <div class="header">
    Answer
  </div>
  <div class="image content">
 
    <div class="description">
      <div class="ui header">
      <%= form_for [question, Answer.new], :html => {:class => 'ui form'}, remote: true do |f| %>
		  
		  <div class="ui segment">
		  <h3 class="">Mark Scheme</h3>
		  <div style="width: 705px; margin: auto;">
		  <%= question.main_question.answer_html.html_safe rescue nil %>
		  </div>
		  </div>
		  <div class="field">
		    <%= f.label "What went wrong?" %><br>
		    <%= f.text_area :text %>
		  </div>
		  <div class="inline field">
		    <%= f.label :marks %><br>
		    <%= f.number_field :marks_integer, id: "marks-input-#{question.id}" %> / <%= question.total_marks %>
		  </div>
		  <%= f.hidden_field :prev_url, :value => @prev_url %>
		  <div class="actions">
		    <%= f.submit class: "ui red button", :id=> "submit-#{question.id}" %>
		  </div>
		<% end %>

      </div>
      
    </div>
  </div>

	</div>

<script>
$('.answer-modal-<%= question.id %>')
  .modal('attach events', '.answer-<%=question.id %>-button')
;
$("#submit-<%= question.id %>").on("click", function() {
	$(".answer-<%=question.id%>-button").html(($( "#marks-input-<%= question.id %>").val()).concat("/<%= question.total_marks %>"));
})
</script>


  <% end %>
  <% if mq.questions.count == 0 then %>
  <div style="width:705px; margin: auto; page-break-inside: avoid; align: center"><%= mq.html.html_safe %></div>
  <% end %>

  <div class="ui secondary segment">
  Topics:
  <% mq.objectives.uniq.each do |obj|  %>
    <div class="ui blue label"><%= obj.name rescue nil %></div>
  <% end %>
  Source:<div class="right floated ui label"><%= mq.source %></div>
  </div>
</div>
<% end %>
<% if @test_paper.main_questions.count == 0 then %>
	<div class="ui basic segment">
		<h2 class="ui centered header">This paper has no questions.</h2>
		<h3 class="ui centered header"><%= link_to "Manually add some", edit_test_paper_path(@test_paper) %></h3>
		<div class="ui  horizontal divider">
	   		Or
	  	</div>
		<h3 class="ui centered header"><%= link_to "Add through Exampro", test_papers_upload_path(:test_paper_id => @test_paper.id)  %></h3>
	</div>
<% end %>
</div>


